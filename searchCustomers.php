<?php include('includes/_.php'); check_auth(); if ( $_SESSION['access_level'] < 3) {	die('<h1>Unauthorized</h1>');        } $_SESSION['view'] = 'Customers'; get_header(); function displayResults($db) {            echo" <h3>Found customers</h3>				<div id='profileBox'></div>				<form action='$PHP_SELF' method='GET'>                <table  align='center' id='employeesTable' class='profile_sect'>                <tr align = 'center'>                <th> &nbsp &nbsp First Name &nbsp &nbsp </th>                <th> &nbsp &nbsp Last Name &nbsp &nbsp </th>                <th> &nbsp &nbsp e-Mail ID &nbsp &nbsp </th>                <th> &nbsp &nbsp Street Address &nbsp &nbsp </th>                <th> &nbsp &nbsp Suite &nbsp &nbsp </th>                <th> &nbsp &nbsp City &nbsp &nbsp </th>                <th> &nbsp &nbsp State &nbsp &nbsp </th>                <th> &nbsp &nbsp Zipcode &nbsp &nbsp </th>                <th> &nbsp &nbsp Type &nbsp &nbsp </th>                </tr>				";            $counter=0;            while($rows = $db->result->fetch_assoc())            {                $counter+=1;                echo"                        <tr align = 'center' id = '$counter' onmouseover = 'changeRowColor(this,true);' onmouseout = 'changeRowColor(this,false);'                onclick='pageRedirect($counter);'>                            <td>$rows[first_name]</td>                            <td>$rows[last_name]</td>                            <td>&nbsp $rows[email] &nbsp</td>                            <td>$rows[street]</td>							<td>$rows[suite]</td>                            <td>$rows[city]</td>                            <td>$rows[state]</td>                            <td>$rows[zipcode]</td>							";				if($rows['type']=="b") {echo"<td>Business</td>";}				else {echo"<td>Individual</td>";}                echo"</tr>";            }			echo" </table></form>"; }?><h1>Customers</h1><?php//Searched for customers matching criteria	 if(isset($_GET['submit'])) {    //Grab variables	 $first_name = $_GET['firstname'];	 $last_name = $_GET['lastname'];	 $email = $_GET['email'];	 $city = $_GET['city'];	 $state = $_GET['state'];	 $zip = $_GET['zip'];	 $busName = $_GET['busName'];	 $busWebsite = $_GET['busWebsite'];	 $busContact = $_GET['busContact'];	 $ordSDate = $_GET['ordSDate'];	 $ordEDate = $_GET['ordEDate'];	 $ordType = $_GET['ordType']; 	 $comSDate = $_GET['comSDate']; 	 $comEDate = $_GET['comEDate']; 	 $leadSDate = $_GET['leadSDate']; 	 $leadEDate = $_GET['leadEDate'];	 $leadType = $_GET['leadType'];	 $leadRank = $_GET['leadRank'];	//Forms myqsl query to search for customers matching all criteria	 $dataString = "";	 $added = false;	 $added2 = false;	 $goahead = false;	//Customer specific criteria	 if($first_name!="") {if($added){$dataString=$dataString." and ";} $added=true;$dataString=$dataString."first_name = '".$first_name."'";}	 if($last_name!="") {if($added){$dataString=$dataString." and ";} $added=true;$dataString=$dataString."last_name = '".$last_name."'";}	 if($email!="") {if($added){$dataString=$dataString." and ";} $added=true;$dataString=$dataString."email = '".$email."'";} 	 if($city!="") {if($added){$dataString=$dataString." and ";} $added=true;$dataString=$dataString."city = '".$city."'";}	 if($state!="") {if($added){$dataString=$dataString." and ";} $added=true;$dataString=$dataString."state = '".$state."'";} 	 if($zip!="") {if($added){$dataString=$dataString." and ";} $added=true;$dataString=$dataString."zipcode = '".$zip."'";}	//Business criteria	 if(isset($_GET['typeB']))	 {		if($busName!="") {			    if($added||$added2){$dataString=$dataString." and ";}				if(!$added2){				$dataString=$dataString."id in (select customer_id from business_customers where ";} $added=true;$added2=true;$dataString=$dataString."business_name = '".$busName."'";}		if($busWebsite!="") {if($added||$added2){$dataString=$dataString." and ";}				if(!$added2){$dataString=$dataString."id in (select customer_id from business_customers where ";}$added=true;$added2=true;$dataString=$dataString."url = '".$busWebsite."'";}		if($busContact!="") {if($added||$added2){$dataString=$dataString." and ";}				if(!$added2){$dataString=$dataString."id in (select customer_id from business_customers where ";}$added=true;$added2=true;$dataString=$dataString."contact_title = '".$busContact."'";}		 if($added2) {$dataString=$dataString.")";}	 }	//Orders criteria	 $added2 = false;	 if($ordSDate!="") {if($added||$added2){$dataString=$dataString." and ";}			if(!$added2){$dataString=$dataString."id in (select customer_id from customer_orders where ";} $added=true;$added2=true;			$dataString=$dataString."date > '".$ordSDate."'";}	 if($ordEDate!="") {if($added||$added2){$dataString=$dataString." and ";}			if(!$added2){$dataString=$dataString."id in (select customer_id from customer_orders where ";} $added=true;$added2=true;			$dataString=$dataString."date < '".$ordEDate."'";}	 if($ordType!="") {}	 if($added2) {$dataString=$dataString.")";}	//Complaints criteria	 if(isset($_GET['comOpen'])) {}	 if(isset($_GET['comClosed'])) {}	//Leads criteria	//Customer type criteria	 if(isset($_GET['typeI'])&&!isset($_GET['typeB']))		 {if($added){$dataString=$dataString." and ";} $added=true;$dataString=$dataString."type = 'i'";}	 if(!isset($_GET['typeI'])&&isset($_GET['typeB']))		 {if($added){$dataString=$dataString." and ";} $added=true;$dataString=$dataString."type = 'b'";}	 if(isset($_GET['typeI'])&&isset($_GET['typeB'])) {$goahead=true;}	 if($added) {$goahead=true;}	//Retrieves customer information from database	 if($goahead) { if($added){$dataString="where ".$dataString;}	 $db->runQuery("select first_name,last_name,email,street,suite,city,state,zipcode,type from customers $dataString");	 //$record = $db->result->fetch_object();	 //$n1 = $record->first_name;		  if  ($db->result->num_rows > 0)		  {			  displayResults($db);			  $customerFound=1;		  }		  else		 {			  echo "<h5>No customers found</h5>";		 }	 } }?><h3>Find a customer</h3><div id="customer-search-wrap"><form id="find-customer" ><ul class="search-criteria-list"><li><a href="#details">Details</a><table id="#details" class="table2"><tr><td>First name<td><td><input type="text" class="full" name="firstname"/></td></tr><tr><td>Last name<td><td><input type="text" class="full" name="lastname"/></td></tr><tr><td>Email Address<td><td><input type="text" class="full" name="email"/></td></tr><tr><td>City<td><td><input type="text" class="mid" name="city"/></td></tr><tr><td>State<td><td><input type="text" class="mid" name="state"/></td></tr><tr><td>Zipcode<td><td><input type="text" maxlength="5" size="5" name="zip"/></td></tr><tr><td>Type<td><td><input type="checkbox" name="typeI" checked="true"/>Individual<input type="checkbox" name="typeB" checked="true"/>Business</td></tr></table></li><li><a href="#details">Business Details</a><table class="table2"><tr><td>Company<td><td><input type="text" class="full" name="busName"/></td></tr><tr><td>Website<td><td><input type="text" class="full" name="busWebsite"/></td></tr><tr><td>Contact<td><td><input type="text" class="full" name="busContact"/></td></tr></table></li><li><a href="#details">Orders</a><table class="table2"><tr><td>Order Date<td align="right">from: <td><input id="orderStartDate" type="text" class="date-field" name="ordSDate"/></td></tr><tr><td><td align="right">to: <td><input id="orderEndDate" type="text" class="date-field" name="ordEDate"/></td></tr><tr><td>Order type<td><td><select name="ordType"><option value=""></option><option value="Sales">Sales</option><option value="Repair">Repair</option><option value="Installation">Installation</option></select></td></tr></table></li><li><a href="#">Complaints</a><table class="table2"><tr><td>Complaint Date<td align="right">from: <td><input id="complaintStartDate" type="text" class="date-field" name="comSDate"/></td></tr><tr><td><td align="right">to: <td><input id="complaintEndDate" type="text" class="date-field" name="comEDate"/></td></tr><tr><td>Complaint Status<td><td><input type="checkbox" checked="false" name="comOpen"/>Open<input type="checkbox" checked="false" name="comClosed"/>Closed</td></tr></table></li><li><a href="#">Leads</a><table class="table2"><tr><td>Creation Date<td align="right">from: <td><input id="leadStartDate" type="text" class="date-field" name="leadSDate"/></td></tr><tr><td><td align="right">to: <td><input id="leadEndDate" type="text" class="date-field" name="leadEDate"/></td></tr><tr><td>Lead type<td><td><select name="leadType"><option value=""></option><option value="Sales">Sales</option><option value="Repair">Repair</option><option value="Installation">Installation</option></select></td></tr><tr><td>Rank<td><td><select name="leadRank"><option value="0"></option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td></tr></table></li><li style="background:#fff;padding:10px 0;"><input type="submit" value="Search" name="submit" /></li></ul></form></div>        <script type='text/javascript' src='assets/js/jquery.js'></script>        <script type='text/javascript' src='assets/js/jquery.ui.js'></script>        <script type='text/javascript'>           $(document).ready(function(){           $('#complaintStartDate').datepicker({ showOn: 'button', buttonImageOnly: true, buttonImage: 'assets/images/datePicker.gif',dateFormat: 'yy-mm-dd'});            });           $(document).ready(function(){           $('#complaintEndDate').datepicker({ showOn: 'button', buttonImageOnly: true, buttonImage: 'assets/images/datePicker.gif', dateFormat: 'yy-mm-dd'});            });		   $(document).ready(function(){           $('#orderStartDate').datepicker({ showOn: 'button', buttonImageOnly: true, buttonImage: 'assets/images/datePicker.gif',dateFormat: 'yy-mm-dd'});            });           $(document).ready(function(){           $('#orderEndDate').datepicker({ showOn: 'button', buttonImageOnly: true, buttonImage: 'assets/images/datePicker.gif', dateFormat: 'yy-mm-dd'});            });			           $(document).ready(function(){           $('#leadStartDate').datepicker({ showOn: 'button', buttonImageOnly: true, buttonImage: 'assets/images/datePicker.gif',dateFormat: 'yy-mm-dd'});            });           $(document).ready(function(){           $('#leadEndDate').datepicker({ showOn: 'button', buttonImageOnly: true, buttonImage: 'assets/images/datePicker.gif', dateFormat: 'yy-mm-dd'});            });        </script><?php get_footer(); ?>