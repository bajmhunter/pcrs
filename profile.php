<?php include('includes/_.php'); check_auth(); $_SESSION['view'] = 'Profile'; get_header();    global $db;    //if the current use  $uid = isset( $_REQUEST['id'] ) ? $_REQUEST['id'] : $_SESSION['user_id'];  $domain = isset( $_REQUEST['domain'] ) ? $_REQUEST['domain'] : ( ( $_SESSION['access_level'] < 2 ) ? 'customers' : 'employees' ) ;  $extra = ( $domain=='customers' ) ? 'type' : 'access_level as al';    //make sure a customer is not attempting to view another customer's profile  if( $_SESSION['access_level'] == 1 && $_SESSION['user_id'] != $uid ) die("Unauthorized!");  //simply error check  if( !$domain == 'customers' || !$domain == 'employees') die("Unknown Domain");    //query database  $query = sprintf("select id,first_name,last_name,email,street,suite,city,state,zipcode,%s from %s where id = %s;",$extra, $domain, $uid );  $db->runQuery($query);  $rec = $db->result->fetch_object();  //$rec->suite = isset($rec->suite) ? $rec->suite : ''; //replace null with empty string  $pdata = json_encode($rec);    if($rec->type=='b'){    $query = sprintf("select business_name, contact_title, url as URL from business_customers where customer_id = %s;", $uid );    $db->runQuery($query);    $bdata = json_encode( $db->result->fetch_object() );  }  else $bdata = "null";?><h1 id="profile-h1"> <a href="#" id="edit-profile-link">Edit</a></h1><div id="profileBox"></div><script type="text/javascript">var pdata = <?php echo $pdata; ?>;var bdata = <?php echo $bdata; ?>;var html = '';var formhtml = '';$('#profile-h1').prepend( pdata['first_name']+' '+pdata['last_name'] );//print personal datavar str= ['<h3>Personal Info</h3><table class="profile_sect">'];var st2= ['<h3>Edit Personal Info</h3><form><table class="profile_sect">'];for (var key in pdata){  if(key=='type' || key=='id' || key=='al') continue;  str.push('<tr><td class="field">',key.replace('_',' ').capitalize(),'</td><td>',pdata[key],'</td></tr>');  st2.push('<tr><td class="field">',key.replace('_',' ').capitalize(),'</td><td><input type=text name=',key,' value="',pdata[key],'"/></td></tr>');}str.push('</table>');st2.push('</table>'); html += str.join('');formhtml += st2.join('');st2 = [];if(bdata !=null){  str= ['<h3>Business Info</h3><table class="profile_sect">'];  st2= ['<h3>Edit Buiness Info</h3><form><table class="profile_sect">'];  for (var key in bdata){    st2.push('<tr><td class="field">',key.replace('_',' ').capitalize(),'</td><td><input type="text" name=',key,' value="',bdata[key],'"/></td></tr>');    str.push('<tr><td class="field">',key.replace('_',' ').capitalize(),'</td><td>',bdata[key],'</td></tr>');  }  str.push('</table>');  st2.push('</table>');   html += str.join('');}st2.push('<input type="submit" value="Update"/><input type="button" value="Cancel" id="cancel-edit"/><input type="hidden" name="update" value="1"</form>');formhtml += st2.join('');$('#profileBox').append( html );$('#edit-profile-link').click( function(){  if( $(this).html() == 'Edit' ){    $(this).html('Cancel');    $('#profileBox').html(formhtml);    $('#cancel-edit').click( function(){$('#edit-profile-link').click();} );  }  else{    $('#profileBox').html( html );    $(this).html('Edit');  }    return false;});</script><?php get_footer(); ?>